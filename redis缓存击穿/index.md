# Redis缓存击穿、雪崩、穿透

## 缓存穿透

> 简单地就是用户请求透过`redis`直接进入到`mysql`当中进行查询，通常是一个不存在的`key`,在数据库查询为`null`。每次请求落在数据库、并且高并发。数据库扛不住会挂掉。

1. 当用户的请求进入到`Redis`当中的时候,`Redis`当中并没有用户查询的键。
2. `Redis`会告诉用户没有查询到此`Key`，随后请求会被直接转发到后台`MySQL`当中
3. `MySQL`当中自然也不会存在此键值对,所以当大量的请求落在`MySQL`当中则会导致数据库宕机

### 解决缓存穿透的方案

- 可以将查到的null设成该key的缓存对象。
- 当然，也可以根据明显错误的key在逻辑层就就行`验证`。
- 同时，你也可以分析用户行为，是否为故意请求或者爬虫、攻击者。针对用户访问做限制。
- 其他等等，比如用布隆过滤器(超大型hashmap)先过滤。

## 缓存雪崩

> 和雪崩一样。在这里，就是`redis`缓存集体`大规模集体失效`，在高并发情况下突然使得key大规模访问`mysql`，使得数据库崩掉。

### 解决缓存雪崩

- 通常的解决方案是将key的过期时间后面加上一个`随机数`，让key均匀的失效。
- 考虑用队列或者锁让程序执行在压力范围之内，当然这种方案可能会影响并发量。
- 热点数据可以考虑不失效

## 缓存击穿

> 缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。

- 击穿和穿透不同，穿透的意思是想法`绕过`redis去使得数据库崩掉。而击穿你可以理解为`正面刚`击穿,这种通常为大量并发对一个key进行大规模的读写操作。这个key在缓存失效期间大量请求数据库，对数据库造成太大压力使得数据库崩掉。就`比如`在秒杀场景下10000块钱的mac和100块的mac这个100块的那个订单肯定会被抢到爆，不断的请求(当然具体秒杀有自己处理方式这里只是举个例子)。所以缓存击穿就是针对某个常用key大量请求导致数据库崩溃。

### 解决缓存击穿

- 可以使用互斥锁避免大量请求同时落到db。
- 布隆过滤器，判断某个容器是否在集合中
- 可以将缓存设置永不过期(适合部分情况)
- 做好熔断、降级，防止系统崩溃。
